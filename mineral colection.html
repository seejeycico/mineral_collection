<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mineral Collection Manager</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel (pre JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- FontAwesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom scrollbar pre čistý vzhľad */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        #map {
            height: 100%;
            width: 100%;
            z-index: 1;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- MOCK DÁTA (Aby aplikácia nebola prázdna) ---
        const initialMinerals = [
            {
                id: 1,
                name: "Opál drahý",
                locality: "Dubník, Červenica",
                country: "Slovensko",
                lat: 48.9167,
                lng: 21.4667,
                purchasePrice: 150,
                estimatedValue: 300,
                acquired: "2022-05-12",
                type: "Oxidy",
                associations: ["Limonit", "Andezit"],
                note: "Krásna hra farieb, historická lokalita."
            },
            {
                id: 2,
                name: "Antimonit",
                locality: "Kremnica",
                country: "Slovensko",
                lat: 48.7052,
                lng: 18.9156,
                purchasePrice: 0,
                estimatedValue: 80,
                acquired: "2023-08-20",
                type: "Sulfidy",
                associations: ["Kremeň", "Zlato"],
                note: "Vlastný nález na halde, pekné ihlice do 5cm."
            },
            {
                id: 3,
                name: "Fluorit",
                locality: "Rogerley Mine",
                country: "UK",
                lat: 54.733,
                lng: -2.017,
                purchasePrice: 200,
                estimatedValue: 220,
                acquired: "2021-11-05",
                type: "Halogenidy",
                associations: ["Galenit"],
                note: "Silná denná fluorescencia."
            }
        ];

        // --- KOMPONENTY ---

        // 1. CHART KOMPONENT (Chart.js Wrapper)
        const ChartComponent = ({ type, data, options }) => {
            const chartRef = useRef(null);
            const canvasRef = useRef(null);

            useEffect(() => {
                if (canvasRef.current) {
                    if (chartRef.current) {
                        chartRef.current.destroy();
                    }
                    
                    chartRef.current = new Chart(canvasRef.current, {
                        type: type,
                        data: data,
                        options: {
                            ...options,
                            maintainAspectRatio: false,
                            plugins: {
                                ...options.plugins,
                                tooltip: {
                                    callbacks: {
                                        title: function(tooltipItems) {
                                            const item = tooltipItems[0];
                                            let label = item.chart.data.labels[item.dataIndex];
                                            if (Array.isArray(label)) {
                                                return label.join(' ');
                                            } else {
                                                return label;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                return () => {
                    if (chartRef.current) chartRef.current.destroy();
                };
            }, [data, type, options]);

            return (
                <div className="chart-container">
                    <canvas ref={canvasRef}></canvas>
                </div>
            );
        };

        // 2. MAPA KOMPONENT (Leaflet Wrapper)
        const MapComponent = ({ minerals }) => {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);

            useEffect(() => {
                if (mapRef.current && !mapInstanceRef.current) {
                    // Inicializácia mapy (stred Slovensko)
                    mapInstanceRef.current = L.map(mapRef.current).setView([48.669, 19.699], 7);

                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; OpenStreetMap contributors'
                    }).addTo(mapInstanceRef.current);
                }

                // Aktualizácia markerov
                if (mapInstanceRef.current) {
                    // Vyčistiť staré markery (zjednodušené: v reálnej app by sme použili LayerGroup)
                    mapInstanceRef.current.eachLayer((layer) => {
                        if (layer instanceof L.CircleMarker) {
                            mapInstanceRef.current.removeLayer(layer);
                        }
                    });

                    minerals.forEach(m => {
                        if (m.lat && m.lng) {
                            L.circleMarker([m.lat, m.lng], {
                                color: '#0ea5e9', // Sky-500
                                fillColor: '#0ea5e9',
                                fillOpacity: 0.5,
                                radius: 10
                            })
                            .bindPopup(`<b>${m.name}</b><br>${m.locality}`)
                            .addTo(mapInstanceRef.current);
                        }
                    });
                }
            }, [minerals]);

            return <div id="map" ref={mapRef} className="rounded-lg shadow-inner border border-slate-200"></div>;
        };

        // HLAVNÁ APLIKÁCIA
        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [minerals, setMinerals] = useState(initialMinerals);
            const [searchTerm, setSearchTerm] = useState("");
            
            // State pre formulár
            const [newMineral, setNewMineral] = useState({
                name: "", locality: "", country: "", lat: "", lng: "", 
                purchasePrice: "", estimatedValue: "", type: "Silikáty", note: ""
            });

            // --- VÝPOČTY PRE DASHBOARD ---
            const totalValue = useMemo(() => minerals.reduce((acc, curr) => acc + Number(curr.estimatedValue || 0), 0), [minerals]);
            const totalCost = useMemo(() => minerals.reduce((acc, curr) => acc + Number(curr.purchasePrice || 0), 0), [minerals]);
            const profit = totalValue - totalCost;

            // Príprava dát pre grafy
            const typeDistribution = useMemo(() => {
                const counts = {};
                minerals.forEach(m => { counts[m.type] = (counts[m.type] || 0) + 1; });
                return {
                    labels: Object.keys(counts),
                    datasets: [{
                        data: Object.values(counts),
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'],
                    }]
                };
            }, [minerals]);

            const valueComparisonData = useMemo(() => {
                return {
                    labels: ['Investícia (Nákup)', 'Odhadovaná hodnota'],
                    datasets: [{
                        label: 'Suma v EUR',
                        data: [totalCost, totalValue],
                        backgroundColor: ['#64748b', '#10b981'],
                        borderRadius: 5
                    }]
                };
            }, [totalCost, totalValue]);


            // --- HANDLERS ---
            const handleAddMineral = (e) => {
                e.preventDefault();
                const mineralToAdd = {
                    ...newMineral,
                    id: Date.now(),
                    acquired: new Date().toISOString().split('T')[0],
                    associations: [] // Placeholder
                };
                setMinerals([...minerals, mineralToAdd]);
                setNewMineral({ name: "", locality: "", country: "", lat: "", lng: "", purchasePrice: "", estimatedValue: "", type: "Silikáty", note: "" });
                alert("Minerál pridaný do zbierky!");
                setActiveTab('list');
            };

            const openExternalSearch = (service, mineral) => {
                let url = "";
                const query = encodeURIComponent(mineral.name);
                const loc = encodeURIComponent(mineral.locality);
                
                switch(service) {
                    case 'mindat': url = `https://www.mindat.org/search.php?name=${query}`; break;
                    case 'ebay': url = `https://www.ebay.com/sch/i.html?_nkw=${query}+${loc}`; break;
                    case 'google': url = `https://www.google.com/search?q=${query}+${loc}+mineral`; break;
                    default: return;
                }
                window.open(url, '_blank');
            };

            const filteredMinerals = minerals.filter(m => 
                m.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                m.locality.toLowerCase().includes(searchTerm.toLowerCase())
            );

            // --- RENDER ---
            return (
                <div className="min-h-screen flex flex-col md:flex-row bg-slate-50">
                    
                    {/* SIDEBAR NAVIGATION */}
                    <aside className="w-full md:w-64 bg-slate-900 text-white flex-shrink-0">
                        <div className="p-6 flex items-center space-x-3">
                            <i className="fa-solid fa-gem text-emerald-400 text-2xl"></i>
                            <h1 className="text-xl font-bold tracking-wider">GeoCollection</h1>
                        </div>
                        <nav className="mt-6 px-2 space-y-2">
                            {[
                                { id: 'dashboard', icon: 'fa-chart-pie', label: 'Prehľad' },
                                { id: 'list', icon: 'fa-list', label: 'Moja Zbierka' },
                                { id: 'add', icon: 'fa-plus', label: 'Pridať minerál' },
                                { id: 'map', icon: 'fa-map-location-dot', label: 'Mapa nálezov' },
                            ].map(item => (
                                <button 
                                    key={item.id}
                                    onClick={() => setActiveTab(item.id)}
                                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ${activeTab === item.id ? 'bg-emerald-600 text-white' : 'text-slate-300 hover:bg-slate-800'}`}
                                >
                                    <i className={`fa-solid ${item.icon} w-6`}></i>
                                    <span>{item.label}</span>
                                </button>
                            ))}
                        </nav>
                        
                        <div className="absolute bottom-0 w-full md:w-64 p-4 border-t border-slate-700">
                            <div className="bg-slate-800 rounded p-3 text-xs text-slate-400">
                                <p>Prihlásený užívateľ:</p>
                                <p className="font-bold text-white">Marek Zberateľ</p>
                            </div>
                        </div>
                    </aside>

                    {/* MAIN CONTENT AREA */}
                    <main className="flex-1 p-4 md:p-8 overflow-y-auto h-screen">
                        
                        {/* HEADER */}
                        <header className="mb-8 flex justify-between items-center">
                            <h2 className="text-2xl font-bold text-slate-800">
                                {activeTab === 'dashboard' && 'Dashboard Zbierky'}
                                {activeTab === 'list' && 'Katalóg Minerálov'}
                                {activeTab === 'add' && 'Nová Evidencia'}
                                {activeTab === 'map' && 'Geolokácia Nálezov'}
                            </h2>
                            {activeTab === 'list' && (
                                <div className="relative">
                                    <input 
                                        type="text" 
                                        placeholder="Hľadať minerál alebo lokalitu..." 
                                        className="pl-10 pr-4 py-2 rounded-full border border-slate-300 focus:outline-none focus:ring-2 focus:ring-emerald-500 w-64"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                    <i className="fa-solid fa-search absolute left-3 top-3 text-slate-400"></i>
                                </div>
                            )}
                        </header>

                        {/* DASHBOARD VIEW */}
                        {activeTab === 'dashboard' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                {/* KPI CARDS */}
                                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                    <div className="text-slate-500 text-sm font-medium uppercase">Počet vzoriek</div>
                                    <div className="text-3xl font-bold text-slate-800 mt-2">{minerals.length}</div>
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                    <div className="text-slate-500 text-sm font-medium uppercase">Odhadovaná hodnota</div>
                                    <div className="text-3xl font-bold text-emerald-600 mt-2">{totalValue} €</div>
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                    <div className="text-slate-500 text-sm font-medium uppercase">Investícia</div>
                                    <div className="text-3xl font-bold text-slate-800 mt-2">{totalCost} €</div>
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                    <div className="text-slate-500 text-sm font-medium uppercase">Zhodnotenie</div>
                                    <div className={`text-3xl font-bold mt-2 ${profit >= 0 ? 'text-emerald-500' : 'text-red-500'}`}>
                                        {profit > 0 ? '+' : ''}{profit} €
                                    </div>
                                </div>

                                {/* CHARTS */}
                                <div className="md:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                    <h3 className="font-bold text-lg mb-4 text-slate-700">Ekonomika Zbierky</h3>
                                    <ChartComponent 
                                        type="bar" 
                                        data={valueComparisonData} 
                                        options={{
                                            indexAxis: 'y',
                                            plugins: { legend: { display: false } }
                                        }} 
                                    />
                                </div>
                                <div className="md:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                    <h3 className="font-bold text-lg mb-4 text-slate-700">Zloženie podľa typu</h3>
                                    <ChartComponent 
                                        type="doughnut" 
                                        data={typeDistribution} 
                                        options={{ plugins: { legend: { position: 'right' } } }} 
                                    />
                                </div>
                            </div>
                        )}

                        {/* LIST VIEW */}
                        {activeTab === 'list' && (
                            <div className="grid grid-cols-1 gap-4">
                                {filteredMinerals.map(mineral => (
                                    <div key={mineral.id} className="bg-white rounded-xl shadow-sm border border-slate-100 p-6 flex flex-col md:flex-row gap-6 hover:shadow-md transition-shadow">
                                        {/* Image Placeholder */}
                                        <div className="w-full md:w-48 h-32 bg-slate-100 rounded-lg flex items-center justify-center text-slate-400 flex-shrink-0">
                                            <i className="fa-solid fa-image text-3xl"></i>
                                        </div>
                                        
                                        {/* Details */}
                                        <div className="flex-1">
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <span className="text-xs font-bold text-emerald-600 uppercase tracking-wide bg-emerald-50 px-2 py-1 rounded">{mineral.type}</span>
                                                    <h3 className="text-xl font-bold text-slate-900 mt-1">{mineral.name}</h3>
                                                    <p className="text-slate-500"><i className="fa-solid fa-location-dot mr-1"></i> {mineral.locality}, {mineral.country}</p>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-sm text-slate-400">Hodnota</div>
                                                    <div className="text-xl font-bold text-slate-800">{mineral.estimatedValue} €</div>
                                                </div>
                                            </div>
                                            
                                            <div className="mt-4 flex flex-wrap gap-2 text-sm text-slate-600">
                                                {mineral.associations.map((assoc, idx) => (
                                                    <span key={idx} className="bg-slate-100 px-2 py-1 rounded border border-slate-200">
                                                        + {assoc}
                                                    </span>
                                                ))}
                                            </div>

                                            {/* Smart Context Buttons */}
                                            <div className="mt-4 pt-4 border-t border-slate-100 flex gap-2">
                                                <button onClick={() => openExternalSearch('mindat', mineral)} className="flex items-center space-x-1 px-3 py-1 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded text-sm font-medium transition-colors">
                                                    <i className="fa-solid fa-book"></i> <span>Mindat</span>
                                                </button>
                                                <button onClick={() => openExternalSearch('ebay', mineral)} className="flex items-center space-x-1 px-3 py-1 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded text-sm font-medium transition-colors">
                                                    <i className="fa-brands fa-ebay"></i> <span>Aukcie</span>
                                                </button>
                                                <button onClick={() => openExternalSearch('google', mineral)} className="flex items-center space-x-1 px-3 py-1 bg-white border border-slate-200 hover:bg-slate-50 text-slate-600 rounded text-sm font-medium transition-colors">
                                                    <i className="fa-brands fa-google"></i> <span>Info</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                {filteredMinerals.length === 0 && (
                                    <div className="text-center py-12 text-slate-400">
                                        <i className="fa-regular fa-folder-open text-4xl mb-4"></i>
                                        <p>Nenašli sa žiadne minerály.</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* ADD FORM */}
                        {activeTab === 'add' && (
                            <div className="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-sm border border-slate-100">
                                <h3 className="text-lg font-bold text-slate-800 mb-6 border-b pb-2">Základné údaje</h3>
                                <form onSubmit={handleAddMineral} className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Názov minerálu</label>
                                            <input required type="text" className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none" 
                                                value={newMineral.name} onChange={e => setNewMineral({...newMineral, name: e.target.value})} placeholder="napr. Antimonit" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Chemická skupina</label>
                                            <select className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none"
                                                value={newMineral.type} onChange={e => setNewMineral({...newMineral, type: e.target.value})}>
                                                <option>Prvky</option>
                                                <option>Sulfidy</option>
                                                <option>Halogenidy</option>
                                                <option>Oxidy</option>
                                                <option>Uhličitany</option>
                                                <option>Silikáty</option>
                                                <option>Fosfáty</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Lokalita (Nálezisko)</label>
                                        <input required type="text" className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none" 
                                            value={newMineral.locality} onChange={e => setNewMineral({...newMineral, locality: e.target.value})} placeholder="napr. Dúbrava, Nízke Tatry" />
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Nákupná cena (€)</label>
                                            <input type="number" className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none" 
                                                value={newMineral.purchasePrice} onChange={e => setNewMineral({...newMineral, purchasePrice: e.target.value})} placeholder="0" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Odhadovaná cena (€)</label>
                                            <input type="number" className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none" 
                                                value={newMineral.estimatedValue} onChange={e => setNewMineral({...newMineral, estimatedValue: e.target.value})} placeholder="0" />
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Zemepisná šírka (Lat)</label>
                                            <input type="number" step="0.0001" className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none" 
                                                value={newMineral.lat} onChange={e => setNewMineral({...newMineral, lat: e.target.value})} placeholder="48.1234" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Zemepisná dĺžka (Lng)</label>
                                            <input type="number" step="0.0001" className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none" 
                                                value={newMineral.lng} onChange={e => setNewMineral({...newMineral, lng: e.target.value})} placeholder="19.1234" />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Poznámka</label>
                                        <textarea className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-emerald-500 outline-none" rows="3"
                                            value={newMineral.note} onChange={e => setNewMineral({...newMineral, note: e.target.value})}></textarea>
                                    </div>

                                    <button type="submit" className="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-lg transition-colors shadow-lg shadow-emerald-200">
                                        Uložiť do zbierky
                                    </button>
                                </form>
                            </div>
                        )}

                        {/* MAP VIEW */}
                        {activeTab === 'map' && (
                            <div className="h-[600px] bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col">
                                <h3 className="text-lg font-bold text-slate-800 mb-4">Mapa lokalít</h3>
                                <div className="flex-1 rounded-lg overflow-hidden">
                                    <MapComponent minerals={minerals} />
                                </div>
                                <p className="text-sm text-slate-500 mt-2">Zobrazujú sa len minerály s vyplnenými GPS súradnicami.</p>
                            </div>
                        )}

                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>